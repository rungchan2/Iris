# ì‚¬ì—°ëª¨ì§‘ì†Œ ê¸°ìˆ  ìŠ¤í™ ë¬¸ì„œ

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ë²„ì „**: v1.0
- **í”„ë¡œì íŠ¸**: Iris - ì‚¬ì—°ëª¨ì§‘ì†Œ
- **ê¸°ìˆ  ìŠ¤íƒ**: Next.js 15 (App Router), Tailwind CSS, shadcn/ui, Supabase

---

## 1. ê¸°ìˆ  ìŠ¤íƒ

### 1.1 Core Framework
- **Next.js**: 15.x (App Router)
- **React**: 18.x
- **TypeScript**: 5.x
- **Node.js**: 20.x ì´ìƒ

### 1.2 Styling
- **Tailwind CSS**: 3.x
- **shadcn/ui**: latest
- **class-variance-authority**: latest
- **tailwind-merge**: latest
- **clsx**: latest

### 1.3 Backend & Database
- **Supabase**: @supabase/supabase-js 2.x
- **Supabase SSR**: @supabase/ssr latest

### 1.4 Form & Validation
- **React Hook Form**: 7.x
- **Zod**: 3.x

### 1.5 UI Components
- **Radix UI**: (shadcn/ui í¬í•¨)
- **Lucide React**: latest (ì•„ì´ì½˜)

### 1.6 Utilities
- **date-fns**: 3.x (ë‚ ì§œ ì²˜ë¦¬)
- **uuid**: 9.x (ì„¸ì…˜ í† í° ìƒì„±)
- **js-cookie**: 3.x (ì¿ í‚¤ ê´€ë¦¬)

---

## 2. íŒ¨í‚¤ì§€ ì„¤ì¹˜

### 2.1 í”„ë¡œì íŠ¸ ì´ˆê¸°í™”

```bash
# Next.js í”„ë¡œì íŠ¸ ìƒì„±
npx create-next-app@latest iris-story --typescript --tailwind --app --no-src-dir

cd iris-story
```

### 2.2 í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
# Supabase
npm install @supabase/supabase-js @supabase/ssr

# Form & Validation
npm install react-hook-form zod @hookform/resolvers

# UI Components (shadcn/ui)
npx shadcn-ui@latest init

# ê°œë³„ shadcn ì»´í¬ë„ŒíŠ¸ ì„¤ì¹˜
npx shadcn-ui@latest add button
npx shadcn-ui@latest add input
npx shadcn-ui@latest add textarea
npx shadcn-ui@latest add label
npx shadcn-ui@latest add select
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add alert
npx shadcn-ui@latest add badge
npx shadcn-ui@latest add card
npx shadcn-ui@latest add toast
npx shadcn-ui@latest add separator
npx shadcn-ui@latest add checkbox
npx shadcn-ui@latest add radio-group
npx shadcn-ui@latest add progress

# Utilities
npm install date-fns uuid js-cookie
npm install -D @types/uuid @types/js-cookie

# Icons
npm install lucide-react
```

---

## 3. í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡°

```
iris-story/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx                    # Root layout
â”‚   â”œâ”€â”€ page.tsx                      # ì‚¬ì—° ì‘ì„± ë©”ì¸ í˜ì´ì§€ â­
â”‚   â”œâ”€â”€ stories/
â”‚   â”‚   â””â”€â”€ page.tsx                  # ì‚¬ì—° ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ (Phase 2)
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â””â”€â”€ stories/
â”‚   â”‚       â””â”€â”€ page.tsx              # ê´€ë¦¬ì ì‚¬ì—° ìŠ¹ì¸ í˜ì´ì§€
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ stories/
â”‚           â””â”€â”€ submit/
â”‚               â””â”€â”€ route.ts          # ì‚¬ì—° ì œì¶œ API (ì„œë²„ ì‚¬ì´ë“œ ì „ìš©)
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                           # shadcn/ui ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ textarea.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ stories/
â”‚   â”‚   â”œâ”€â”€ story-form.tsx            # ì‚¬ì—° ì‘ì„± í¼
â”‚   â”‚   â”œâ”€â”€ image-uploader.tsx        # ì´ë¯¸ì§€ ì—…ë¡œë“œ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ tag-selector.tsx          # íƒœê·¸ ì„ íƒ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ character-counter.tsx     # ê¸€ì ìˆ˜ ì¹´ìš´í„°
â”‚   â”‚   â”œâ”€â”€ example-modal.tsx         # ì‘ì„± ì˜ˆì‹œ ëª¨ë‹¬
â”‚   â”‚   â”œâ”€â”€ coupon-modal.tsx          # ì¿ í° ë°œê¸‰ ëª¨ë‹¬
â”‚   â”‚   â””â”€â”€ draft-restore-dialog.tsx  # ì„ì‹œì €ì¥ ë³µì› ë‹¤ì´ì–¼ë¡œê·¸
â”‚   â””â”€â”€ admin/
â”‚       â””â”€â”€ story-moderation-table.tsx # ê´€ë¦¬ì ì‚¬ì—° ìŠ¹ì¸ í…Œì´ë¸”
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”œâ”€â”€ client.ts                 # í´ë¼ì´ì–¸íŠ¸ Supabase ì¸ìŠ¤í„´ìŠ¤
â”‚   â”‚   â”œâ”€â”€ server.ts                 # ì„œë²„ Supabase ì¸ìŠ¤í„´ìŠ¤
â”‚   â”‚   â””â”€â”€ middleware.ts             # Supabase ë¯¸ë“¤ì›¨ì–´
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ stories.service.ts        # ì‚¬ì—° ê´€ë ¨ DB í•¨ìˆ˜
â”‚   â”‚   â”œâ”€â”€ coupons.service.ts        # ì¿ í° ê´€ë ¨ DB í•¨ìˆ˜
â”‚   â”‚   â””â”€â”€ spam-detection.service.ts # ìŠ¤íŒ¸ ë°©ì§€ ë¡œì§
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ cn.ts                     # className ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”œâ”€â”€ validators.ts             # Zod ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â””â”€â”€ constants.ts              # ìƒìˆ˜ ì •ì˜
â”‚   â””â”€â”€ types/
â”‚       â”œâ”€â”€ database.types.ts         # Supabase íƒ€ì… (ìë™ ìƒì„±)
â”‚       â””â”€â”€ story.types.ts            # ì‚¬ì—° ê´€ë ¨ íƒ€ì…
â”‚
â”œâ”€â”€ hooks/                            # ì»¤ìŠ¤í…€ í›… â­
â”‚   â”œâ”€â”€ use-auto-save.ts              # ì„ì‹œì €ì¥ í›…
â”‚   â”œâ”€â”€ use-session-token.ts          # ì„¸ì…˜ í† í° ê´€ë¦¬ í›…
â”‚   â”œâ”€â”€ use-writing-timer.ts          # ì‘ì„± ì‹œê°„ ì¶”ì  í›…
â”‚   â””â”€â”€ use-story-submit.ts           # ì‚¬ì—° ì œì¶œ í›…
â”‚
â”œâ”€â”€ spec/                             # í”„ë¡œì íŠ¸ ìŠ¤í™ ë¬¸ì„œ â­
â”‚   â”œâ”€â”€ mvp-spec.md                   # MVP ê¸°íšì„œ
â”‚   â”œâ”€â”€ tech-spec.md                  # ê¸°ìˆ  ìŠ¤í™ ë¬¸ì„œ (ì´ ë¬¸ì„œ)
â”‚   â”œâ”€â”€ database-schema.md            # DB ìŠ¤í‚¤ë§ˆ ë¬¸ì„œ
â”‚   â””â”€â”€ api-spec.md                   # API ëª…ì„¸ì„œ
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ images/
â”‚       â””â”€â”€ examples/                 # ì‘ì„± ì˜ˆì‹œ ì´ë¯¸ì§€
â”‚
â”œâ”€â”€ .env.local                        # í™˜ê²½ ë³€ìˆ˜ (gitignore)
â”œâ”€â”€ .env.example                      # í™˜ê²½ ë³€ìˆ˜ í…œí”Œë¦¿
â”œâ”€â”€ middleware.ts                     # Next.js ë¯¸ë“¤ì›¨ì–´
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

---

## 4. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### 4.1 `.env.local` (gitignoreì— ì¶”ê°€ í•„ìˆ˜)

```env
# Supabase - Public Keys (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key

# Supabase - Private Keys (ì„œë²„ ì‚¬ì´ë“œ ì „ìš©, ì ˆëŒ€ ë…¸ì¶œ ê¸ˆì§€)
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# App Configuration
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### 4.2 `.env.example` (Gitì— ì»¤ë°‹)

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# App Configuration
NEXT_PUBLIC_APP_URL=
```

---

## 5. ë³´ì•ˆ ê°€ì´ë“œë¼ì¸ âš ï¸

### 5.1 í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ

**âœ… DO - ì•ˆì „í•œ ì‚¬ìš©ë²•**:
```typescript
// í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ - Public Keysë§Œ ì‚¬ìš©
'use client'
const url = process.env.NEXT_PUBLIC_SUPABASE_URL // âœ… OK
const anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY // âœ… OK

// ì„œë²„ ì»´í¬ë„ŒíŠ¸/API Route - Private Keys ì‚¬ìš© ê°€ëŠ¥
const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY // âœ… OK (ì„œë²„ ì „ìš©)
```

**âŒ DON'T - ìœ„í—˜í•œ ì‚¬ìš©ë²•**:
```typescript
// í´ë¼ì´ì–¸íŠ¸ì—ì„œ Private Key ì‚¬ìš© (ì ˆëŒ€ ê¸ˆì§€!)
'use client'
const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY // âŒ ë…¸ì¶œ ìœ„í—˜!
```

### 5.2 API Route ë³´ì•ˆ íŒ¨í„´

**ëª¨ë“  ë¯¼ê°í•œ ì‘ì—…ì€ API Routeì—ì„œë§Œ ìˆ˜í–‰**:

```typescript
// âŒ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§ì ‘ DB ì ‘ê·¼ (ì·¨ì•½)
'use client'
function BadComponent() {
  const supabase = createClient()
  const handleSubmit = async () => {
    await supabase.from('stories').insert({ ... }) // âŒ RLS ìš°íšŒ ê°€ëŠ¥
  }
}

// âœ… API Routeë¥¼ í†µí•œ ì ‘ê·¼ (ì•ˆì „)
'use client'
function GoodComponent() {
  const handleSubmit = async () => {
    await fetch('/api/stories/submit', {
      method: 'POST',
      body: JSON.stringify(data)
    }) // âœ… ì„œë²„ ê²€ì¦ ê±°ì¹¨
  }
}
```

### 5.3 ì‚¬ì—° ì œì¶œ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ì„œë²„ ì‚¬ì´ë“œ ê²€ì¦ (API Routeì—ì„œ í•„ìˆ˜)**:
- [ ] IP ì£¼ì†Œ ì¶”ì¶œ ë° ê²€ì¦
- [ ] ì„¸ì…˜ í† í° ê²€ì¦
- [ ] ì‘ì„± ì‹œê°„ ê²€ì¦
- [ ] ì…ë ¥ê°’ Sanitization
- [ ] Rate Limiting
- [ ] SQL Injection ë°©ì§€ (Supabaseê°€ ìë™ ì²˜ë¦¬)

**í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ê²€ì¦ (UX í–¥ìƒìš©)**:
- [ ] Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦
- [ ] ê¸€ì ìˆ˜ ì œí•œ
- [ ] ì´ë¯¸ì§€ í¬ê¸° ì œí•œ
- [ ] íŒŒì¼ íƒ€ì… ê²€ì¦

### 5.4 Row Level Security (RLS) í•„ìˆ˜ ì„¤ì •

**Supabase Dashboardì—ì„œ RLS í™œì„±í™”**:

```sql
-- stories í…Œì´ë¸”
ALTER TABLE stories ENABLE ROW LEVEL SECURITY;

-- coupons í…Œì´ë¸”
ALTER TABLE coupons ENABLE ROW LEVEL SECURITY;

-- coupon_templates í…Œì´ë¸”
ALTER TABLE coupon_templates ENABLE ROW LEVEL SECURITY;
```

**ì •ì±… ì˜ˆì‹œ**:
```sql
-- ëˆ„êµ¬ë‚˜ ì‚¬ì—° ì œì¶œ ê°€ëŠ¥ (INSERTë§Œ)
CREATE POLICY "Anyone can submit stories"
ON stories FOR INSERT
WITH CHECK (true);

-- ë³¸ì¸ ì‚¬ì—°ë§Œ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Users can view own stories"
ON stories FOR SELECT
USING (
  auth.uid() = user_id OR
  session_token = current_setting('request.cookies.iris_session_token', true)
);
```

### 5.5 XSS ë°©ì§€

**ì‚¬ìš©ì ì…ë ¥ì€ í•­ìƒ Escape ì²˜ë¦¬**:

```typescript
// Reactê°€ ê¸°ë³¸ì ìœ¼ë¡œ XSS ë°©ì§€
<div>{story.body}</div> // âœ… ìë™ escape

// dangerouslySetInnerHTML ì‚¬ìš© ê¸ˆì§€
<div dangerouslySetInnerHTML={{ __html: story.body }} /> // âŒ ìœ„í—˜!

// ì´ë¯¸ì§€ URL ê²€ì¦
function validateImageUrl(url: string): boolean {
  return url.startsWith(process.env.NEXT_PUBLIC_SUPABASE_URL!)
}
```

### 5.6 CORS ì„¤ì •

**API Routeì—ì„œ CORS ì œí•œ**:

```typescript
// app/api/stories/submit/route.ts
export async function POST(request: NextRequest) {
  // Origin ê²€ì¦
  const origin = request.headers.get('origin')
  const allowedOrigins = [
    process.env.NEXT_PUBLIC_APP_URL,
    'https://iris.com'
  ]
  
  if (origin && !allowedOrigins.includes(origin)) {
    return NextResponse.json(
      { error: 'Forbidden' },
      { status: 403 }
    )
  }
  
  // ... ë¡œì§
}
```

### 5.7 ë¯¼ê° ì •ë³´ ë¡œê¹… ê¸ˆì§€

```typescript
// âŒ ë¯¼ê° ì •ë³´ ë¡œê¹… ê¸ˆì§€
console.log('User session:', sessionToken) // âŒ
console.log('IP address:', ipAddress) // âŒ

// âœ… ì•ˆì „í•œ ë¡œê¹…
console.log('Story submitted:', storyId) // âœ…
console.error('Submission failed:', { storyId, reason: 'validation' }) // âœ…
```

---

## 5. Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •

### 5.1 `/lib/supabase/client.ts` (í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ìš©)

**íŒ¨í„´**:
- `createBrowserClient` ì‚¬ìš©
- Public Keysë§Œ ì‚¬ìš©
- Database íƒ€ì… ì œë„¤ë¦­ ì ìš©

**ì‚¬ìš© ì˜ˆì‹œ**:
```typescript
'use client'
import { createClient } from '@/lib/supabase/client'

function Component() {
  const supabase = createClient() // ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±
  // ...
}
```

### 5.2 `/lib/supabase/server.ts` (ì„œë²„ ì»´í¬ë„ŒíŠ¸/APIìš©)

**íŒ¨í„´**:
- `createServerClient` ì‚¬ìš©
- Cookie í•¸ë“¤ë§ í¬í•¨
- `async/await` í•„ìˆ˜ (cookies() ì‚¬ìš©)

**ì‚¬ìš© ì˜ˆì‹œ**:
```typescript
import { createClient } from '@/lib/supabase/server'

async function ServerComponent() {
  const supabase = await createClient() // async í•„ìˆ˜
  // ...
}
```

### 5.3 `/middleware.ts` (Supabase Auth ë¯¸ë“¤ì›¨ì–´)

**ì—­í• **:
- ì„¸ì…˜ ê°±ì‹ 
- ì¸ì¦ ìƒíƒœ ì²´í¬
- ì •ì  íŒŒì¼ ì œì™¸

**ë§¤ì²˜ ì„¤ì •**:
- ì´ë¯¸ì§€, í°íŠ¸ ë“± ì •ì  íŒŒì¼ ì œì™¸
- API Route í¬í•¨

---

## 6. íƒ€ì… ì •ì˜

### 6.1 ë°ì´í„°ë² ì´ìŠ¤ íƒ€ì… ìƒì„±

```bash
# Supabase CLIë¡œ íƒ€ì… ìë™ ìƒì„±
npx supabase gen types typescript --project-id kypwcsgwjtnkiiwjedcn > lib/types/database.types.ts
```

### 6.2 `/lib/types/story.types.ts`

**íŒ¨í„´**:
- Database íƒ€ì…ì—ì„œ Row/Insert/Update ì¶”ì¶œ
- í¼ ë°ì´í„° íƒ€ì… ë³„ë„ ì •ì˜
- API ìš”ì²­/ì‘ë‹µ íƒ€ì… ëª…ì‹œ

**ì£¼ìš” íƒ€ì…**:
- `Story`, `StoryInsert`, `StoryUpdate`
- `StoryFormData` (í¼ ì…ë ¥)
- `StorySubmitRequest` (API ìš”ì²­)
- `StorySubmitResponse` (API ì‘ë‹µ)
- `StoryDraft` (ì„ì‹œì €ì¥)

---

## 7. ìƒìˆ˜ ë° ìœ í‹¸ë¦¬í‹°

### 7.1 `/lib/utils/constants.ts`

**ì •ì˜í•  ìƒìˆ˜**:
- `STORY_TAGS`: ê°ì • íƒœê·¸ ë°°ì—´
- `VISIBILITY_OPTIONS`: ê³µê°œ ë²”ìœ„ ì˜µì…˜
- `STORY_LIMITS`: ê¸€ì ìˆ˜/ì´ë¯¸ì§€ ì œí•œ
- `SPAM_PREVENTION`: ìŠ¤íŒ¸ ë°©ì§€ ì„¤ì •
- `COOKIE_NAMES`: ì¿ í‚¤ í‚¤ê°’
- `STORAGE_KEYS`: ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í‚¤ê°’
- `DRAFT_SETTINGS`: ì„ì‹œì €ì¥ ì„¤ì •

### 7.2 `/lib/utils/validators.ts`

**Zod ìŠ¤í‚¤ë§ˆ ì •ì˜**:
- `storyFormSchema`: ì‚¬ì—° ì‘ì„± í¼ ê²€ì¦
- ê° í•„ë“œë³„ min/max ì œí•œ
- ì»¤ìŠ¤í…€ ì—ëŸ¬ ë©”ì‹œì§€

**íŒ¨í„´**:
```typescript
export const storyFormSchema = z.object({
  title: z.string().min(1).max(100),
  body: z.string().min(50).max(1000),
  // ...
})

export type StoryFormSchema = z.infer<typeof storyFormSchema>
```

---

## 8. Services (DB í•¨ìˆ˜)

### 8.1 `/lib/services/stories.service.ts`

**í•¨ìˆ˜ ì‘ì„± íŒ¨í„´**:
```typescript
// ì„œë²„ ì „ìš© í•¨ìˆ˜
export async function createStory(data: StoryInsert) {
  const supabase = await createServerClient() // ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±
  const { data: story, error } = await supabase
    .from('stories')
    .insert(data)
    .select()
    .single()
  
  if (error) throw error
  return story
}
```

**ì£¼ìš” í•¨ìˆ˜**:
- `createStory`: ì‚¬ì—° ìƒì„±
- `checkRecentSubmissionBySession`: ì¬ì œì¶œ ì²´í¬
- `countSubmissionsByIP`: IP ê¸°ë°˜ ì œì¶œ ìˆ˜
- `countStoriesByUser/Session`: ì‚¬ìš©ìë³„ ì‚¬ì—° ìˆ˜
- `getPendingStories`: ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡
- `approveStory` / `rejectStory`: ìŠ¹ì¸/ê±°ì ˆ

**ì›ì¹™**:
- ëª¨ë“  í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `createClient()` í˜¸ì¶œ
- ì—ëŸ¬ëŠ” throwë¡œ ì „íŒŒ
- íƒ€ì… ì•ˆì „ì„± ë³´ì¥

### 8.2 `/lib/services/coupons.service.ts`

**ì£¼ìš” í•¨ìˆ˜**:
- `issueCoupon`: ì¿ í° ë°œê¸‰ (ì²« ì‚¬ì—° íŒë‹¨ í¬í•¨)
- `revokeCouponsByStory`: ê±°ì ˆ ì‹œ ì¿ í° ì·¨ì†Œ
- `getUserCoupons`: ì‚¬ìš©ì ì¿ í° ì¡°íšŒ

**ì¿ í° ì½”ë“œ ìƒì„± íŒ¨í„´**:
- `generateCouponCode(prefix, length)`: ëœë¤ ì½”ë“œ ìƒì„±
- í˜¼ë™ ë¬¸ì ì œì™¸ (0, O, I, l ë“±)

### 8.3 `/lib/services/spam-detection.service.ts`

**ê²€ì¦ ìˆœì„œ**:
1. ì„¸ì…˜ í† í° ì¬ì œì¶œ ì²´í¬ (10ë¶„)
2. IP ê¸°ë°˜ ì œì¶œ íšŸìˆ˜ ì²´í¬ (1ì‹œê°„/3íšŒ)
3. ì‘ì„± ì‹œê°„ ì²´í¬ (30ì´ˆ ì´ìƒ)

**ë°˜í™˜ íƒ€ì…**:
```typescript
interface SpamCheckResult {
  isAllowed: boolean
  reason?: string
  retryAfter?: number
}
```

---

## 9. Custom Hooks

### 9.1 `/hooks/use-session-token.ts`

**ì—­í• **: ë¸Œë¼ìš°ì € ì„¸ì…˜ í† í° ìƒì„±/ê´€ë¦¬

**íŒ¨í„´**:
- UUID v4 ìƒì„±
- js-cookieë¡œ permanent cookie ì €ì¥
- useStateë¡œ ìƒíƒœ ê´€ë¦¬

### 9.2 `/hooks/use-writing-timer.ts`

**ì—­í• **: ì‘ì„± ì†Œìš” ì‹œê°„ ì¶”ì 

**íŒ¨í„´**:
- useRefë¡œ ì‹œì‘ ì‹œê°„ ì €ì¥
- setIntervalë¡œ 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
- cleanup í•¨ìˆ˜ë¡œ interval ì •ë¦¬

### 9.3 `/hooks/use-auto-save.ts`

**ì—­í• **: ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì„ì‹œì €ì¥

**íŒ¨í„´**:
- useCallbackë¡œ ì €ì¥ í•¨ìˆ˜ ì •ì˜
- useEffect + setTimeoutìœ¼ë¡œ debounce (3ì´ˆ)
- ì œëª©/ë‚´ìš© ìˆì„ ë•Œë§Œ ì €ì¥

**ì¶”ê°€ í•¨ìˆ˜**:
- `loadDraft()`: ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (7ì¼ ì´ë‚´)
- `clearDraft()`: ì €ì¥ ë°ì´í„° ì‚­ì œ

### 9.4 `/hooks/use-story-submit.ts`

**ì—­í• **: API í˜¸ì¶œ ë° ìƒíƒœ ê´€ë¦¬

**íŒ¨í„´**:
- useStateë¡œ loading/error ê´€ë¦¬
- fetchë¡œ API í˜¸ì¶œ
- ì—ëŸ¬ í•¸ë“¤ë§

---

## 10. API Route

### 10.1 `/app/api/stories/submit/route.ts`

**ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] IP ì£¼ì†Œ ì¶”ì¶œ (`x-forwarded-for` í—¤ë”)
- [ ] Origin ê²€ì¦ (CORS)
- [ ] ìŠ¤íŒ¸ ê²€ì¦ (`validateSubmission`)
- [ ] ì…ë ¥ê°’ ê²€ì¦ (Zod ìŠ¤í‚¤ë§ˆ)
- [ ] Rate Limiting

**ì²˜ë¦¬ ìˆœì„œ**:
1. Request Body íŒŒì‹±
2. IP ì£¼ì†Œ ì¶”ì¶œ
3. ìŠ¤íŒ¸ ê²€ì¦
4. ì‚¬ì—° ì €ì¥ (ì˜ì‹¬ í”Œë˜ê·¸ í¬í•¨)
5. ì¿ í° ë°œê¸‰
6. ì‘ë‹µ ë°˜í™˜

**ì—ëŸ¬ ì‘ë‹µ íŒ¨í„´**:
```typescript
if (!spamCheck.isAllowed) {
  return NextResponse.json(
    {
      success: false,
      error: spamCheck.reason,
      message: getErrorMessage(spamCheck.reason),
      retryAfter: spamCheck.retryAfter
    },
    { status: 429 } // Too Many Requests
  )
}
```

--- story.visibility,
      author_name: story.authorName,
      user_id: userId,
      session_token: session.token,
      ip_address: ip,
      user_agent: request.headers.get('user-agent') || '',
      writing_duration_sec: session.writingDuration,
      submitted_from_url: session.referer,
      is_suspicious: isSuspicious,
      suspicious_reason: isSuspicious ? 'fast_writing' : null,
      moderation_status: 'pending'
    })
    
    // ì¿ í° ë°œê¸‰
    const couponData = await issueCoupon(
      savedStory.id,
      userId,
      session.token
    )
    
    const response: StorySubmitResponse = {
      success: true,
      story: {
        id: savedStory.id,
        title: savedStory.title,
        createdAt: savedStory.created_at
      },
      coupon: {
        code: couponData.code,
        discount: `${couponData.template.discount_value}${
          couponData.template.discount_type === 'percentage' ? '%' : 'ì›'
        }`,
        validUntil: couponData.valid_until,
        terms: couponData.template.terms_description || ''
      }
    }
    
    return NextResponse.json(response)
    
  } catch (error) {
    console.error('Story submission error:', error)
    
    const response: StorySubmitResponse = {
      success: false,
      error: 'INTERNAL_ERROR',
      message: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'
    }
    
    return NextResponse.json(response, { status: 500 })
  }
}

function getErrorMessage(errorCode: string): string {
  const messages: Record<string, string> = {
    TOO_FREQUENT: '10ë¶„ í›„ ë‹¤ì‹œ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤',
    RATE_LIMIT_EXCEEDED: 'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”',
    SUSPICIOUS_SPEED: 'ì‘ì„± ì‹œê°„ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”'
  }
  
  return messages[errorCode] || 'ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤'
}
```

---

## 11. ê°œë°œ ê°€ì´ë“œë¼ì¸

### 11.1 Supabase í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš© ê·œì¹™

**ì„œë²„ ì»´í¬ë„ŒíŠ¸ / API Route**:
```typescript
import { createClient } from '@/lib/supabase/server'

async function ServerComponent() {
  const supabase = await createClient() // í•­ìƒ ìƒˆë¡œ ìƒì„±
  // ...
}
```

**í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸**:
```typescript
'use client'
import { createClient } from '@/lib/supabase/client'

function ClientComponent() {
  const supabase = createClient() // í•­ìƒ ìƒˆë¡œ ìƒì„±
  // ...
}
```

### 11.2 Services í•¨ìˆ˜ ì‘ì„± ê·œì¹™

**íŒ¨í„´**:
1. ëª¨ë“  í•¨ìˆ˜ëŠ” ë‚´ë¶€ì—ì„œ `createClient()` í˜¸ì¶œ
2. ì„œë²„ í•¨ìˆ˜ì™€ í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜ ëª…í™•íˆ êµ¬ë¶„
3. ì—ëŸ¬ëŠ” throwë¡œ ì „íŒŒ
4. íƒ€ì…ì€ `database.types.ts`ì—ì„œ import

**ì˜ˆì‹œ**:
```typescript
// âœ… ì˜¬ë°”ë¥¸ íŒ¨í„´
export async function someFunction() {
  const supabase = await createClient() // í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìƒì„±
  const { data, error } = await supabase.from('table').select()
  if (error) throw error
  return data
}

// âŒ ì˜ëª»ëœ íŒ¨í„´
const supabase = createClient() // íŒŒì¼ ìµœìƒë‹¨ì—ì„œ ìƒì„± ê¸ˆì§€
export async function someFunction() {
  // ...
}
```

### 11.3 ì»´í¬ë„ŒíŠ¸ êµ¬ì¡° ê°€ì´ë“œë¼ì¸

**í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸**:
- 'use client' ì§€ì‹œë¬¸ ëª…ì‹œ
- ì»¤ìŠ¤í…€ í›… ì‚¬ìš©
- API Routeë¡œ ë°ì´í„° ì „ì†¡
- ì§ì ‘ DB ì ‘ê·¼ ê¸ˆì§€ (ë³´ì•ˆ)

**ì„œë²„ ì»´í¬ë„ŒíŠ¸**:
- ë°ì´í„° fetching ë‹´ë‹¹
- Services í•¨ìˆ˜ ì§ì ‘ í˜¸ì¶œ ê°€ëŠ¥
- useState/useEffect ì‚¬ìš© ë¶ˆê°€

### 11.4 ì—ëŸ¬ í•¸ë“¤ë§ íŒ¨í„´

**Services ë ˆì´ì–´**:
```typescript
export async function getData() {
  const supabase = await createClient()
  const { data, error } = await supabase.from('table').select()
  
  if (error) throw error // throwë¡œ ì „íŒŒ
  return data
}
```

**API Route**:
```typescript
export async function GET() {
  try {
    const data = await getData()
    return NextResponse.json({ success: true, data })
  } catch (error) {
    console.error('Error:', error)
    return NextResponse.json(
      { success: false, error: 'Internal error' },
      { status: 500 }
    )
  }
}
```

**í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸**:
```typescript
'use client'
function Component() {
  const [error, setError] = useState<string | null>(null)
  
  const handleSubmit = async () => {
    try {
      const response = await fetch('/api/endpoint')
      const result = await response.json()
      
      if (!result.success) {
        setError(result.error)
      }
    } catch (err) {
      setError('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤')
    }
  }
}
```

### 11.5 íƒ€ì… ì•ˆì „ì„± ê°€ì´ë“œ

**Database íƒ€ì… í™œìš©**:
```typescript
import { Database } from '@/lib/types/database.types'

type Story = Database['public']['Tables']['stories']['Row']
type StoryInsert = Database['public']['Tables']['stories']['Insert']
```

**Zod ìŠ¤í‚¤ë§ˆ í™œìš©**:
```typescript
import { storyFormSchema } from '@/lib/utils/validators'

// í´ë¼ì´ì–¸íŠ¸ ê²€ì¦
const result = storyFormSchema.safeParse(formData)
if (!result.success) {
  console.error(result.error.flatten())
}

// ì„œë²„ ê²€ì¦
const validated = storyFormSchema.parse(body)
```

### 11.6 ì„í¬íŠ¸ ìˆœì„œ ê·œì¹™

```typescript
// 1. External libraries
import { useState } from 'react'
import { createClient } from '@supabase/ssr'

// 2. Internal libraries
import { createClient } from '@/lib/supabase/client'
import { createStory } from '@/lib/services/stories.service'

// 3. Components
import { Button } from '@/components/ui/button'
import StoryForm from '@/components/stories/story-form'

// 4. Types
import type { Story, StoryFormData } from '@/lib/types/story.types'

// 5. Utils
import { cn } from '@/lib/utils/cn'
import { STORY_TAGS } from '@/lib/utils/constants'
```

### 11.7 íŒŒì¼ ëª…ëª… ê·œì¹™

**ì»´í¬ë„ŒíŠ¸**: `kebab-case.tsx`
- `story-form.tsx`
- `image-uploader.tsx`

**Services**: `kebab-case.service.ts`
- `stories.service.ts`
- `coupons.service.ts`

**Hooks**: `use-kebab-case.ts`
- `use-session-token.ts`
- `use-auto-save.ts`

**Types**: `kebab-case.types.ts`
- `story.types.ts`
- `database.types.ts`

**Utils**: `kebab-case.ts`
- `validators.ts`
- `constants.ts`

---

## 12. í…ŒìŠ¤íŠ¸ ê°€ì´ë“œë¼ì¸

### 12.1 ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ì‚¬ì—° ì‘ì„± í”Œë¡œìš°**:
- [ ] í˜ì´ì§€ ì²« ì§„ì… ì‹œ ì„¸ì…˜ í† í° ìƒì„± í™•ì¸
- [ ] ì„ì‹œì €ì¥ ìë™ ë™ì‘ í™•ì¸ (3ì´ˆ debounce)
- [ ] ì„ì‹œì €ì¥ ë³µì› í™•ì¸ (í˜ì´ì§€ ì¬ë°©ë¬¸)
- [ ] ê¸€ì ìˆ˜ ì¹´ìš´í„° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- [ ] 50ì ë¯¸ë§Œ ì‹œ ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”
- [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ (ìµœëŒ€ 3ì¥, 5MB ì œí•œ)
- [ ] íƒœê·¸ ì„ íƒ (ìµœëŒ€ 3ê°œ)
- [ ] ì œì¶œ ì„±ê³µ ì‹œ ì¿ í° ëª¨ë‹¬ í‘œì‹œ
- [ ] beforeunload ê²½ê³  ë™ì‘ í™•ì¸

**ìŠ¤íŒ¸ ë°©ì§€**:
- [ ] 10ë¶„ ë‚´ ì¬ì œì¶œ ì°¨ë‹¨ í™•ì¸
- [ ] 1ì‹œê°„ ë‚´ ë™ì¼ IP 3íšŒ ì œì¶œ ì°¨ë‹¨
- [ ] 30ì´ˆ ë¯¸ë§Œ ì‘ì„± ì‹œ ì˜ì‹¬ í”Œë˜ê·¸
- [ ] reCAPTCHA í‘œì‹œ (ë¹ ë¥¸ ì‘ì„± ì‹œ)

**ê´€ë¦¬ì ê¸°ëŠ¥**:
- [ ] ëŒ€ê¸° ì¤‘ì¸ ì‚¬ì—° ëª©ë¡ ì¡°íšŒ
- [ ] ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì‚¬ì—° ìš°ì„  í‘œì‹œ
- [ ] ì‚¬ì—° ìŠ¹ì¸/ê±°ì ˆ
- [ ] ê±°ì ˆ ì‹œ ì¿ í° ìë™ ì·¨ì†Œ

### 12.2 ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸

**í•„ìˆ˜ ë¸Œë¼ìš°ì €**:
- Chrome (ìµœì‹ )
- Safari (ìµœì‹ )
- Firefox (ìµœì‹ )
- Mobile Safari (iOS)
- Chrome Mobile (Android)

**í…ŒìŠ¤íŠ¸ í•­ëª©**:
- localStorage ë™ì‘
- Cookie ì„¤ì •
- beforeunload ì´ë²¤íŠ¸
- ì´ë¯¸ì§€ ì—…ë¡œë“œ

---

## 13. ë°°í¬ ê°€ì´ë“œë¼ì¸

### 13.1 í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (Vercel)

```bash
# Production í™˜ê²½ ë³€ìˆ˜
NEXT_PUBLIC_SUPABASE_URL=https://prod.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=prod-anon-key
SUPABASE_SERVICE_ROLE_KEY=prod-service-role-key
NEXT_PUBLIC_APP_URL=https://iris.com
```

### 13.2 ë¹Œë“œ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] TypeScript ì—ëŸ¬ ì—†ìŒ (`npm run build`)
- [ ] ESLint ì—ëŸ¬ ì—†ìŒ (`npm run lint`)
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ
- [ ] Supabase RLS ì •ì±… í™œì„±í™”
- [ ] ì´ˆê¸° ë°ì´í„° ì‚½ì… ì™„ë£Œ (ì¿ í° í…œí”Œë¦¿)
- [ ] Database íƒ€ì… ìµœì‹ í™”

### 13.3 ë°°í¬ í›„ í™•ì¸ì‚¬í•­

- [ ] API Route ì •ìƒ ë™ì‘
- [ ] ì‚¬ì—° ì œì¶œ ì •ìƒ ì‘ë™
- [ ] ì¿ í° ë°œê¸‰ ì •ìƒ ì‘ë™
- [ ] ê´€ë¦¬ì í˜ì´ì§€ ì ‘ê·¼ ì œí•œ
- [ ] ìŠ¤íŒ¸ ë°©ì§€ ë¡œì§ ë™ì‘
- [ ] ì—ëŸ¬ ë¡œê¹… í™•ì¸

---

## 14. ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œ

### 14.1 ì´ë¯¸ì§€ ìµœì í™”

**Next.js Image ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©**:
```typescript
import Image from 'next/image'

<Image
  src={imageUrl}
  alt="story image"
  width={800}
  height={600}
  quality={85}
  placeholder="blur"
/>
```

**Supabase Storage ìµœì í™”**:
- ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• (`transform` API)
- WebP ë³€í™˜
- CDN ìºì‹±

### 14.2 ë²ˆë“¤ í¬ê¸° ìµœì í™”

**Dynamic Import**:
```typescript
// ì˜ˆì‹œ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸ lazy loading
const ExampleModal = dynamic(() => import('./example-modal'), {
  loading: () => <Skeleton />
})
```

**Tree Shaking**:
- Named import ì‚¬ìš©
- Barrel export ì§€ì–‘

### 14.3 Database ì¿¼ë¦¬ ìµœì í™”

**Select ìµœì í™”**:
```typescript
// âŒ ëª¨ë“  ì»¬ëŸ¼ ì¡°íšŒ
const { data } = await supabase.from('stories').select('*')

// âœ… í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì¡°íšŒ
const { data } = await supabase
  .from('stories')
  .select('id, title, created_at')
```

**ì¸ë±ìŠ¤ í™œìš©**:
- ìì£¼ ì¡°íšŒí•˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ìƒì„±
- Composite index ê³ ë ¤

---

## 15. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 15.1 ì—ëŸ¬ ëª¨ë‹ˆí„°ë§

**ì¶”ì²œ ë„êµ¬**:
- Sentry
- LogRocket
- Vercel Analytics

**êµ¬í˜„ íŒ¨í„´**:
```typescript
try {
  // ë¡œì§
} catch (error) {
  console.error('Story submission failed:', {
    storyId,
    error: error.message,
    timestamp: new Date().toISOString()
  })
  
  // ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ë¡œ ì „ì†¡
  // Sentry.captureException(error)
}
```

### 15.2 ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

**Core Web Vitals**:
- LCP (Largest Contentful Paint)
- FID (First Input Delay)
- CLS (Cumulative Layout Shift)

**Vercel Analytics**:
```typescript
// app/layout.tsx
import { Analytics } from '@vercel/analytics/react'

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Analytics />
      </body>
    </html>
  )
}
```

### 15.3 ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹

**ì£¼ìš” ì´ë²¤íŠ¸**:
- ì‚¬ì—° ì œì¶œ ì„±ê³µ/ì‹¤íŒ¨
- ì¿ í° ë°œê¸‰
- ì„ì‹œì €ì¥ ì‚¬ìš©
- ì‘ì„± ì†Œìš” ì‹œê°„

**êµ¬í˜„ ì˜ˆì‹œ**:
```typescript
// ì‚¬ì—° ì œì¶œ ì„±ê³µ ì‹œ
trackEvent('story_submitted', {
  storyId,
  writingDuration,
  hasImages: images.length > 0,
  tagCount: tags.length
})
```

---

## 16. ë¬¸ì„œ ì°¸ì¡°

### 16.1 í”„ë¡œì íŠ¸ ìŠ¤í™ ë¬¸ì„œ

ëª¨ë“  ê¸°íš ë° ê¸°ìˆ  ìŠ¤í™ì€ `/spec` í´ë”ì—ì„œ í™•ì¸:

```
/spec/
â”œâ”€â”€ mvp-spec.md              # MVP ê¸°íšì„œ
â”œâ”€â”€ tech-spec.md             # ê¸°ìˆ  ìŠ¤í™ ë¬¸ì„œ (ì´ ë¬¸ì„œ)
â”œâ”€â”€ database-schema.md       # DB ìŠ¤í‚¤ë§ˆ ìƒì„¸
â””â”€â”€ api-spec.md              # API ëª…ì„¸ì„œ
```

### 16.2 ì™¸ë¶€ ë¬¸ì„œ

**Next.js**:
- [App Router ê³µì‹ ë¬¸ì„œ](https://nextjs.org/docs/app)
- [API Routes](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)

**Supabase**:
- [JavaScript Client ë¬¸ì„œ](https://supabase.com/docs/reference/javascript)
- [Auth ë¬¸ì„œ](https://supabase.com/docs/guides/auth)
- [Storage ë¬¸ì„œ](https://supabase.com/docs/guides/storage)

**shadcn/ui**:
- [ì»´í¬ë„ŒíŠ¸ ë¬¸ì„œ](https://ui.shadcn.com)

---

## 17. ê°œë°œ ì›Œí¬í”Œë¡œìš°

### 17.1 ë¸Œëœì¹˜ ì „ëµ

```
main (production)
  â””â”€â”€ develop (staging)
       â”œâ”€â”€ feature/story-form
       â”œâ”€â”€ feature/coupon-system
       â””â”€â”€ feature/admin-panel
```

### 17.2 ì»¤ë°‹ ì»¨ë²¤ì…˜

```
feat: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€
fix: ë²„ê·¸ ìˆ˜ì •
docs: ë¬¸ì„œ ìˆ˜ì •
style: ì½”ë“œ í¬ë§·íŒ… (ê¸°ëŠ¥ ë³€ê²½ ì—†ìŒ)
refactor: ì½”ë“œ ë¦¬íŒ©í† ë§
test: í…ŒìŠ¤íŠ¸ ì½”ë“œ
chore: ë¹Œë“œ ì„¤ì •, íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €
```

**ì˜ˆì‹œ**:
```bash
git commit -m "feat: ì‚¬ì—° ì‘ì„± í¼ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„"
git commit -m "fix: ì„ì‹œì €ì¥ ë³µì› ë²„ê·¸ ìˆ˜ì •"
git commit -m "docs: API ëª…ì„¸ì„œ ì—…ë°ì´íŠ¸"
```

### 17.3 Pull Request í…œí”Œë¦¿

```markdown
## ë³€ê²½ ì‚¬í•­
- êµ¬í˜„í•œ ê¸°ëŠ¥ ë˜ëŠ” ìˆ˜ì •í•œ ë²„ê·¸ ì„¤ëª…

## í…ŒìŠ¤íŠ¸ ì™„ë£Œ í•­ëª©
- [ ] ë¡œì»¬ í™˜ê²½ í…ŒìŠ¤íŠ¸
- [ ] TypeScript ì—ëŸ¬ ì—†ìŒ
- [ ] ESLint í†µê³¼

## ê´€ë ¨ ì´ìŠˆ
- #123

## ìŠ¤í¬ë¦°ìƒ· (UI ë³€ê²½ ì‹œ)
```

---

## 18. íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### 18.1 Supabase ì—°ê²° ì‹¤íŒ¨

**ì¦ìƒ**: "Invalid API key" ë˜ëŠ” ì—°ê²° ì—ëŸ¬

**í•´ê²° ë°©ë²•**:
1. `.env.local` í™˜ê²½ ë³€ìˆ˜ í™•ì¸
2. Supabase Dashboardì—ì„œ í‚¤ ì¬í™•ì¸
3. ì„œë²„ ì¬ì‹œì‘ (`npm run dev`)

### 18.2 RLS ì •ì±… ì—ëŸ¬

**ì¦ìƒ**: "new row violates row-level security policy"

**í•´ê²° ë°©ë²•**:
1. Supabase Dashboardì—ì„œ RLS ì •ì±… í™•ì¸
2. `service_role` í‚¤ ì‚¬ìš© ì—¬ë¶€ í™•ì¸
3. ì •ì±… ì¡°ê±´ ì¬ê²€í† 

### 18.3 íƒ€ì… ì—ëŸ¬

**ì¦ìƒ**: TypeScript íƒ€ì… ë¶ˆì¼ì¹˜

**í•´ê²° ë°©ë²•**:
1. Database íƒ€ì… ì¬ìƒì„±
   ```bash
   npx supabase gen types typescript --project-id kypwcsgwjtnkiiwjedcn > lib/types/database.types.ts
   ```
2. IDE ì¬ì‹œì‘
3. `node_modules` ì‚­ì œ í›„ ì¬ì„¤ì¹˜

### 18.4 Cookie ì„¤ì • ì—ëŸ¬

**ì¦ìƒ**: ì„¸ì…˜ í† í°ì´ ì €ì¥ë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:
1. ë¸Œë¼ìš°ì € ì¿ í‚¤ ì„¤ì • í™•ì¸
2. SameSite ì†ì„± í™•ì¸
3. HTTPS í™˜ê²½ì—ì„œ Secure ì†ì„± í•„ìš”

---

## 19. ë‹¤ìŒ ë‹¨ê³„

### 19.1 Phase 1 ê°œë°œ ìˆœì„œ

1. âœ… í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •
2. âœ… Supabase ì—°ë™
3. âœ… íƒ€ì… ìƒì„±
4. â¬œ DB í…Œì´ë¸” ìƒì„±
5. â¬œ Services í•¨ìˆ˜ êµ¬í˜„
6. â¬œ Custom Hooks êµ¬í˜„
7. â¬œ API Route êµ¬í˜„
8. â¬œ UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
9. â¬œ ì‚¬ì—° ì‘ì„± í˜ì´ì§€ êµ¬í˜„
10. â¬œ ê´€ë¦¬ì í˜ì´ì§€ êµ¬í˜„
11. â¬œ í…ŒìŠ¤íŠ¸ ë° ë°°í¬

### 19.2 ê°œë°œ ì‹œì‘í•˜ê¸°

```bash
# 1. ì˜ì¡´ì„± ì„¤ì¹˜
npm install

# 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.example .env.local
# .env.local íŒŒì¼ ìˆ˜ì •

# 3. Database íƒ€ì… ìƒì„±
npx supabase gen types typescript --project-id kypwcsgwjtnkiiwjedcn > lib/types/database.types.ts

# 4. ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev
```

### 19.3 ì²´í¬ë¦¬ìŠ¤íŠ¸

**í•„ìˆ˜ ì‘ì—…**:
- [ ] `/spec` í´ë”ì— ë¬¸ì„œ ì •ë¦¬
- [ ] `.env.example` íŒŒì¼ ìƒì„±
- [ ] `.gitignore`ì— `.env.local` ì¶”ê°€
- [ ] Supabase í…Œì´ë¸” ìƒì„±
- [ ] RLS ì •ì±… í™œì„±í™”
- [ ] ì´ˆê¸° ë°ì´í„° ì‚½ì…
- [ ] ì²« ë²ˆì§¸ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

---

**ë¬¸ì„œ ì¢…ë£Œ**

ì´ ë¬¸ì„œëŠ” `/spec/tech-spec.md`ì— ì €ì¥í•˜ì—¬ ì°¸ì¡°ìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.