name: ì¬ì˜ë ˆí¬ì— ë³µì œ

on:
  push:
    branches:
      - main

jobs:
  sync-to-fork:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout your code
        uses: actions/checkout@v3

      - name: Set git identity
        run: |
          git config --global user.name "heechan"
          git config --global user.email "leeh09077@gmail.com"

      - name: Add friend's repo and push
        run: |
          # ë””ë²„ê¹…: í† í°ì´ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (ì‹¤ì œ ê°’ì€ í‘œì‹œí•˜ì§€ ì•ŠìŒ)
          if [ -z "${{ secrets.FRIEND_PAT }}" ]; then
            echo "âŒ FRIEND_PATì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!"
            exit 1
          else
            echo "âœ… FRIEND_PATì´ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤."
          fi
          
          # GitHub APIë¡œ ë ˆí¬ì§€í† ë¦¬ ì ‘ê·¼ ê¶Œí•œ í…ŒìŠ¤íŠ¸
          echo "ğŸ” GitHub APIë¡œ ë ˆí¬ì§€í† ë¦¬ ì ‘ê·¼ í…ŒìŠ¤íŠ¸..."
          curl -H "Authorization: token ${{ secrets.FRIEND_PAT }}" \
               -H "Accept: application/vnd.github.v3+json" \
               https://api.github.com/repos/sunsetcinematic/sunset-cinema || echo "API ì ‘ê·¼ ì‹¤íŒ¨"
          
          # Git credential ì„¤ì •
          echo "ğŸ”§ Git credential ì„¤ì •..."
          git config --global credential.helper store
          echo "https://x-access-token:${{ secrets.FRIEND_PAT }}@github.com" > ~/.git-credentials
          
          # ëŒ€ì•ˆ URL í˜•ì‹ë“¤ í…ŒìŠ¤íŠ¸
          echo "ğŸ” ë‹¤ì–‘í•œ URL í˜•ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸..."
          
          # ë°©ë²• 1: í‘œì¤€ x-access-token
          echo "ë°©ë²• 1: x-access-token í˜•ì‹"
          git ls-remote https://x-access-token:${{ secrets.FRIEND_PAT }}@github.com/sunsetcinematic/sunset-cinema.git || echo "ë°©ë²• 1 ì‹¤íŒ¨"
          
          # ë°©ë²• 2: í† í°ì„ ì‚¬ìš©ìëª…ìœ¼ë¡œ ì‚¬ìš©
          echo "ë°©ë²• 2: í† í°ì„ ì‚¬ìš©ìëª…ìœ¼ë¡œ ì‚¬ìš©"
          git ls-remote https://${{ secrets.FRIEND_PAT }}@github.com/sunsetcinematic/sunset-cinema.git || echo "ë°©ë²• 2 ì‹¤íŒ¨"
          
          # ë°©ë²• 3: rungchan2 ì‚¬ìš©ìëª…ê³¼ í† í°
          echo "ë°©ë²• 3: rungchan2 ì‚¬ìš©ìëª… ì‚¬ìš©"
          git ls-remote https://rungchan2:${{ secrets.FRIEND_PAT }}@github.com/sunsetcinematic/sunset-cinema.git || echo "ë°©ë²• 3 ì‹¤íŒ¨"
          
          # ì„±ê³µí•œ ë°©ë²•ìœ¼ë¡œ push ì‹œë„
          echo "ğŸ“¤ ì„±ê³µí•œ ì¸ì¦ ë°©ì‹ìœ¼ë¡œ ë ˆí¬ì§€í† ë¦¬ì— í‘¸ì‹œ ì‹œë„..."
          
          # ë¨¼ì € ë°©ë²• 1ë¡œ ì‹œë„
          if git remote add friend https://x-access-token:${{ secrets.FRIEND_PAT }}@github.com/sunsetcinematic/sunset-cinema.git 2>/dev/null; then
            echo "âœ… í‘œì¤€ x-access-token ë°©ì‹ìœ¼ë¡œ remote ì¶”ê°€ ì„±ê³µ"
            git push friend main --force
          # ë°©ë²• 1 ì‹¤íŒ¨ì‹œ ë°©ë²• 2 ì‹œë„  
          elif git remote add friend2 https://${{ secrets.FRIEND_PAT }}@github.com/sunsetcinematic/sunset-cinema.git 2>/dev/null; then
            echo "âœ… í† í°-only ë°©ì‹ìœ¼ë¡œ remote ì¶”ê°€ ì„±ê³µ"
            git push friend2 main --force
          # ë°©ë²• 2 ì‹¤íŒ¨ì‹œ ë°©ë²• 3 ì‹œë„
          elif git remote add friend3 https://rungchan2:${{ secrets.FRIEND_PAT }}@github.com/sunsetcinematic/sunset-cinema.git 2>/dev/null; then
            echo "âœ… ì‚¬ìš©ìëª… ë°©ì‹ìœ¼ë¡œ remote ì¶”ê°€ ì„±ê³µ"
            git push friend3 main --force
          else
            echo "âŒ ëª¨ë“  ì¸ì¦ ë°©ì‹ ì‹¤íŒ¨"
            exit 1
          fi
        
        # SSH ë°©ì‹ ëŒ€ì•ˆ (í•„ìš”ì‹œ ì‚¬ìš©):
        # git remote add friend git@github.com:sunsetcinematic/sunset-cinema.git
        # (SSH í‚¤ ì„¤ì • í•„ìš”)