name: 재영레포에 복제

on:
  push:
    branches:
      - main

jobs:
  sync-to-fork:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout your code
        uses: actions/checkout@v3

      - name: Add friend's repo and push
        run: |
          # 디버깅: 토큰이 설정되어 있는지 확인 (실제 값은 표시하지 않음)
          if [ -z "${{ secrets.FRIEND_PAT }}" ]; then
            echo "❌ FRIEND_PAT이 설정되지 않았습니다!"
            exit 1
          else
            echo "✅ FRIEND_PAT이 설정되어 있습니다."
          fi
          
          # Public 레포지토리 접근 테스트
          echo "🔍 Public 레포지토리 접근 테스트..."
          
          # Public 레포는 토큰 없이도 읽기 가능하지만, push를 위해서는 토큰 필요
          if git ls-remote https://github.com/sunsetcinematic/sunset-cinema.git; then
            echo "✅ 레포지토리 접근 성공! (Public 모드)"
          else
            echo "❌ 레포지토리 접근 실패"
            exit 1
          fi
          
          # Git 설정
          echo "🔧 Git 설정 중..."
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # Friend 레포지토리 추가 및 푸시
          echo "📤 Friend 레포지토리에 푸시 중..."
          
          # Public 레포지토리에 토큰으로 푸시
          git remote add friend https://x-access-token:${{ secrets.FRIEND_PAT }}@github.com/sunsetcinematic/sunset-cinema.git
          
          # 강제 푸시로 완전 동기화
          git push friend main --force
          
          echo "✅ 성공적으로 sunsetcinematic/sunset-cinema에 동기화 완료!"
        
        # SSH 방식 대안 (필요시 사용):
        # git remote add friend git@github.com:sunsetcinematic/sunset-cinema.git
        # (SSH 키 설정 필요)