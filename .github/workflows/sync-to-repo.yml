name: Vercel 배포용 레포 동기화

on:
  push:
    branches:
      - main

jobs:
  sync-to-vercel-repo:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # GitHub App 토큰 생성
      - name: Generate GitHub App Token
        id: app-token
        uses: actions/create-github-app-token@v1
        with:
          app-id: ${{ secrets.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}
          owner: sunsetcinematic

      - name: Sync to friend's repository
        env:
          TARGET_REPO: sunsetcinematic/sunset-cinema
          GH_TOKEN: ${{ steps.app-token.outputs.token }}
        run: |
          # Git 설정
          git config --global user.name "vercel-sync-bot"
          git config --global user.email "noreply@github.com"
          
          # 원격 저장소 설정
          git remote add target https://x-access-token:$GH_TOKEN@github.com/$TARGET_REPO.git
          
          # 강제 푸시 (Vercel 배포 트리거)
          git push target main --force
          
          echo "✅ Vercel 배포용 레포에 동기화 완료!"